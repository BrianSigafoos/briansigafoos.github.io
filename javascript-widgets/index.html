<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><title>Embeddable Javascript widgets in Rails - Brian Sigafoos</title><link rel=stylesheet href="/css/main.min.5eb108928bd2dba754c122a4448d5de4b2ea729edc34858e8fd10cb2305491ac.css" integrity="sha256-XrEIkovS26dUwSKkRI1d5LLqcp7cNIWOj9EMsjBUkaw="><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-42740116-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<link rel="shortcut icon" href=/favicon.png?20190809><link rel=apple-touch-icon href=/apple-touch-icon.png?20190809></head><body class="text-color bg-bright antialiased leading-normal"><div class="border-b border-gray py-4 w-full"><div class="container max-w-4xl"><div class="flex items-center justify-between font-mono"><a href=https://briansigafoos.com/ class=font-black>Brian Sigafoos</a>
<a href=/about>About me</a></div></div></div><div class="container my-16 !max-w-4xl"><h1 class=title>Embeddable Javascript widgets in Rails</h1><h3 class=subtitle>How serve javascript embeds from a Rails app, following the pattern of Github gists embed snippets.</h3><p class="font-mono text-faint text-sm">May 22, 2022
·
2 min read</p><div class="border-t border-gray text-readable my-8 pt-4"><h3 id=github-gists-example>Github gists example</h3><p>Github gists are great and easy to share. Simply paste their embed code onto any page.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#999;font-style:italic>&lt;!-- Embed code --&gt;</span>
</span></span><span style=display:flex><span>&lt;<span style=color:#6ab825;font-weight:700>script</span> <span style=color:#bbb>src</span>=<span style=color:#ed9d13>&#34;https://gist.github.com/BrianSigafoos/f0fe5e6417b0acf70ffe1bc6b6498796.js&#34;</span>&gt;&lt;/<span style=color:#6ab825;font-weight:700>script</span>&gt;
</span></span></code></pre></div><p>The response from that script simply does 2 things using <code>document.write()</code>:</p><ol><li>Add a stylesheet</li><li>Add the HTML tags to render the gist content.</li></ol><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#999;font-style:italic>// Endpoint Response to .js code above
</span></span></span><span style=display:flex><span><span style=color:#999;font-style:italic></span><span style=color:#24909d>document</span>.write(
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#39;&lt;link rel=&#34;stylesheet&#34; href=&#34;https://github.githubassets.com/assets/gist-embed-5687a589e344.css&#34; /&gt;&#39;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span><span style=color:#24909d>document</span>.write(
</span></span><span style=display:flex><span>  <span style=color:#ed9d13>&#39;&lt;div id=&#34;gist74791356&#34; class=&#34;gist&#34;&gt;\n &lt;div class=&#34;gist-file&#34; translate=&#34;no&#34;&gt;...&lt;/div&gt;&lt;/div&gt;&lt;/ div&gt;\n&#39;</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><h3 id=recreating-it-in-rails>Recreating it in Rails</h3><p>The code to embed the widget is simple:</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#6ab825;font-weight:700>div</span> <span style=color:#bbb>class</span>=<span style=color:#ed9d13>&#34;demoapp demoapp-widget&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#6ab825;font-weight:700>script</span> <span style=color:#bbb>src</span>=<span style=color:#ed9d13>&#34;http://lvh.me:3000/widgets/mKVEFN.js&#34;</span>&gt;&lt;/<span style=color:#6ab825;font-weight:700>script</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#6ab825;font-weight:700>p</span>&gt;Widget created with &lt;<span style=color:#6ab825;font-weight:700>a</span> <span style=color:#bbb>target</span>=<span style=color:#ed9d13>&#34;_blank&#34;</span> <span style=color:#bbb>rel</span>=<span style=color:#ed9d13>&#34;noopener&#34;</span> <span style=color:#bbb>href</span>=<span style=color:#ed9d13>&#34;https://github.com/BrianSigafoos/docker-rails-webpacker-app&#34;</span>&gt;Docker Rails Demo App&lt;/<span style=color:#6ab825;font-weight:700>a</span>&gt; by Brian&lt;/<span style=color:#6ab825;font-weight:700>p</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#6ab825;font-weight:700>div</span>&gt;
</span></span></code></pre></div><p>And here is a widget rendered below.
Note: this only works locally for now <a href=https://github.com/BrianSigafoos/docker-rails-webpacker-app>via this repo</a>.</p><div class="demoapp demoapp-widget"><script src=http://lvh.me:3000/widgets/1Y5kZh.js></script><p>Widget created with <a href=https://github.com/BrianSigafoos/docker-rails-webpacker-app>Docker Rails Demo App</a> by Brian</p></div><h3 id=how-it-works>How it works</h3><ul><li>Add a new route <code>resources :widgets, only: :show</code></li><li>Add the new WidgetsController with <code>skip_before_action :verify_authenticity_token</code> and <code>layout false</code> with a <a href=https://github.com/BrianSigafoos/docker-rails-webpacker-app/blob/main/app/views/widgets/widgets/show.js.erb>show.js.erb like this</a></li><li>Add the <code>rack-cors</code> gem to allow CORS with a <a href=https://github.com/BrianSigafoos/docker-rails-webpacker-app/blob/main/config/initializers/cors.rb>config/initializers/cors.rb like this</a></li><li>Add the widget CSS via a new <a href=https://github.com/BrianSigafoos/docker-rails-webpacker-app/blob/main/app/views/widgets/widgets/show.js.erb>widget.scss like this</a><ul><li>You&rsquo;ll want to scope the CSS to only your app <code>:where(.demoapp) { ... }</code>, for example</li></ul></li><li>Add code to generate the copyable widget snippet</li><li>Add code to preview the widget snippet in your app, without any CSS on that page</li></ul></div><div class=my-8><a href=https://briansigafoos.com/ class="btn btn-default">Visit homepage</a></div><div class=my-8><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//briansigafoos.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div class="border-t border-gray py-4 my-16 w-full text-sm text-faint"><div class="container max-w-4xl text-center font-mono"><div class="sm:flex items-center justify-between"><span>Made with
<a href=https://gohugo.io rel=nofollow target=hugo>Hugo</a> &
        <a href=https://tailwindcss.com rel=nofollow target=tw>TailwindCSS</a>
·
<a href=https://github.com/BrianSigafoos/hugo_site class=text-faint rel=nofollow target=source>Source code</a></span>
<span class="block sm:inline mt-2 sm:mt-0">By <a href=/about class=font-black>Brian Sigafoos</a></span></div></div></div></body></html>