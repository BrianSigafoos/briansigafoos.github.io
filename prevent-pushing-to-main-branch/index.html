<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><title>Prevent pushing to main branch - Brian Sigafoos</title>
<link rel=stylesheet href="/css/main.min.9dccf334550d3f0f50f42076b75ac4f739fab5bccb06e4559a7b5a0e4d3c1dd0.css" integrity="sha256-nczzNFUNPw9Q9CB2t1rE9zn6tbzLBuRVmntaDk08HdA="><script src=/main.js></script><link rel="shortcut icon" href=/favicon.png?20190809><link rel=apple-touch-icon href=/apple-touch-icon.png?20190809></head><body data-controller=color-scheme class="text-color bg-bright antialiased leading-normal"><div class="border-b border-gray py-4 w-full"><div class="container max-w-4xl"><div class="flex items-center justify-between font-mono"><a href=https://briansigafoos.com/ class="text-primary font-extrabold">Brian Sigafoos</a><div class="flex items-center"><a href=/about class="text-color font-extrabold block">About me</a><div class="flex ml-4"><button type=button data-action=color-scheme#toggleScheme aria-label="Toggle dark mode" title="Toggle dark mode" class="py-1 px-2 cursor-pointer text-color">
<svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003.0 0012 21a9.003 9.003.0 008.354-5.646z"/></svg>
</button>
<button type=button data-action=color-scheme#toggleColor aria-label="Change primary color" title="Change primary color" class="py-1 px-2 cursor-pointer text-primary"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828.0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"/></svg></button></div></div></div></div></div><div class="container my-12 md:my-16 !max-w-4xl prose md:prose-lg lg:prose-xl prose-custom"><h1>Prevent pushing to main branch</h1><p class="mt-4 text-lg md:text-xl lg:text-2xl text-muted">Use a .git hooks script to prevent accidentally pushing to main branch</p><div class="font-mono text-sm mt-3 space-x-4"><span class=text-muted>Aug 15, 2021</span>
<span class=text-muted>1 min read</span></div><div class="border-t border-gray my-8 pt-4"><h2 id=oops-i-just-pushed-to-main>Oops, I just pushed to main!</h2><p>Pushing to <code>main</code> branch when you meant to push to a new feature branch is embarrassing and annoying.</p><p>Github has a great per repo setting called &ldquo;Branch protection rules&rdquo; that can prevent your team from accidentally pushing to <code>main</code> (or <code>master</code>) branch. And also ensure that status checks like tests and linters all pass.</p><p>If you don&rsquo;t have this set. Or if you&rsquo;re an admin that&rsquo;s allowed to override failed checks, nothing prevents you from pushing to main.</p><h2 id=git-hooks-to-the-rescue>Git hooks to the rescue</h2><ul><li>Copy and paste this into your shell in your local repo directory:</li></ul><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>cat <span style=color:#ed9d13>&lt;&lt; &#39;DOC&#39; &gt; .git/hooks/pre-push
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>protected_branch=&#39;main&#39;
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>current_branch=$(git symbolic-ref HEAD | sed -e &#39;s,.*/\(.*\),\1,&#39;)
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>if [ $protected_branch = $current_branch ]
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>then
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>    read -p &#34;You&#39;re about to push to $protected_branch, is that what you intended? [y|n] &#34; -n 1 -r &lt; /dev/tty
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>    echo
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>    if echo $REPLY | grep -E &#39;^[Yy]$&#39; &gt; /dev/null
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>    then
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>        exit 0 # push will execute
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>    fi
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>    exit 1 # push will not execute
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>else
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>    exit 0 # push will execute
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>fi
</span></span></span><span style=display:flex><span><span style=color:#ed9d13>DOC</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>chmod +x .git/hooks/pre-push
</span></span></code></pre></div><div class="border-t border-b border-gray text-muted my-8 py-4">Read more posts like this in the
<a href=/software-engineering-toolbox>Software Engineering Toolbox</a> collection.</div></div><div class=my-8><a href=https://briansigafoos.com/ class="text-base inline-block mb-1 py-2 px-6 cursor-pointer font-mono font-bold text-primary border border-solid border-primary bg-bright no-underline">Visit homepage</a></div><div class=my-8></div></div><div class="border-t border-gray py-4 my-16 w-full text-sm text-faint"><div class="container max-w-4xl text-center font-mono"><div class="sm:flex items-center justify-between"><span>Made with
<a href=https://gohugo.io rel=nofollow target=hugo class=underline>Hugo</a> &
        <a href=https://tailwindcss.com rel=nofollow target=tw class=underline>TailwindCSS</a>
Â·
<a href=https://github.com/BrianSigafoos/hugo_site rel=nofollow target=source class=underline>Source code
</a></span><span class="block sm:inline mt-2 sm:mt-0">By <a href=/about class="text-primary font-black"></a></span></div></div></div></body></html>