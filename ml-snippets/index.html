<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><title>ML snippets - Brian Sigafoos</title><link rel=stylesheet href="/css/main.min.ebe2862d434098b3f530e43b9c3cc60fc64c17a074083ae7f0e36268138d98c4.css" integrity="sha256-6+KGLUNAmLP1MOQ7nDzGD8ZMF6B0CDrn8ONiaBONmMQ="><script src=/main.js></script>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-42740116-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<link rel="shortcut icon" href=/favicon.png?20190809><link rel=apple-touch-icon href=/apple-touch-icon.png?20190809></head><body data-controller=color-scheme class="text-color bg-bright antialiased leading-normal"><div class="border-b border-gray py-4 w-full"><div class="container max-w-4xl"><div class="flex items-center justify-between font-mono"><a href=https://briansigafoos.com/ class="text-primary font-extrabold">Brian Sigafoos</a><div class="flex items-center"><a href=/about class="text-color font-extrabold block">About me</a><div class="flex ml-4"><button type=button data-action=color-scheme#toggleScheme aria-label="Toggle dark mode" title="Toggle dark mode" class="py-1 px-2 cursor-pointer text-color"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003.0 0012 21a9.003 9.003.0 008.354-5.646z"/></svg></button>
<button type=button data-action=color-scheme#toggleColor aria-label="Change primary color" title="Change primary color" class="py-1 px-2 cursor-pointer text-primary"><svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828.0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"/></svg></button></div></div></div></div></div><div class="container my-12 md:my-16 !max-w-4xl prose md:prose-lg lg:prose-xl prose-custom"><h1>ML snippets</h1><p class="mt-4 text-lg md:text-xl lg:text-2xl text-muted">Snippets of code for getting started with machine learning, using PyTorch, Pandas, Numpy, and Kaggle</p><div class="font-mono text-sm mt-3 space-x-4"><span class=text-muted>Dec 29, 2022</span>
<span class=text-muted>2 min read</span></div><div class="border-t border-gray my-8 pt-4"><h2 id=tips-and-approaches>Tips and approaches</h2><ul><li>For tabular data, start with a <a href=https://en.wikipedia.org/wiki/Random_forest>random forest</a>. This helps get quick insight into the data and establish a base case, before moving on to deep learning approaches. Also they are nearly impossible to screw up, according to J. Howard from fastai.</li><li>Split up data into 3 splits:<ol><li>training split - 80% - used by model to tune itself in backpropagation</li><li>dev/validation split - 10% - used to tune hyperparameters</li><li>test split - 10% - never used to tune model, only used at end</li></ol></li></ul><h2 id=fill-nan-with-modes-using-pandas>Fill NaN with modes using pandas</h2><p>Before and after filling with the modes, run this in a cell:</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df.isna().sum()
</span></span></code></pre></div><p>Fill with the modes:</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#999;font-style:italic># Get the modes for the data frame</span>
</span></span><span style=display:flex><span>modes = df.mode().iloc[<span style=color:#3677a9>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic># Fill NaN values</span>
</span></span><span style=display:flex><span><span style=color:#999;font-style:italic># https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.fillna.html</span>
</span></span><span style=display:flex><span>df.fillna(modes, inplace=<span style=color:#6ab825;font-weight:700>True</span>)
</span></span></code></pre></div><h2 id=use-apples-mac-m1m2-gpus>Use Apple&rsquo;s Mac M1/M2 GPU&rsquo;s</h2><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#999;font-style:italic># https://pytorch.org/docs/stable/notes/mps.html</span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>if</span> <span style=color:#6ab825;font-weight:700>not</span> torch.backends.mps.is_available():
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>if</span> <span style=color:#6ab825;font-weight:700>not</span> torch.backends.mps.is_built():
</span></span><span style=display:flex><span>        <span style=color:#24909d>print</span>(
</span></span><span style=display:flex><span>            <span style=color:#ed9d13>&#34;MPS not available because the current PyTorch install was not &#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#ed9d13>&#34;built with MPS enabled.&#34;</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#24909d>print</span>(
</span></span><span style=display:flex><span>            <span style=color:#ed9d13>&#34;MPS not available because the current MacOS version is not 12.3+ &#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#ed9d13>&#34;and/or you do not have an MPS-enabled device on this machine.&#34;</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>else</span>:
</span></span><span style=display:flex><span>    <span style=color:#24909d>print</span>(<span style=color:#ed9d13>&#34;MPS is available. Setting as default device.&#34;</span>)
</span></span><span style=display:flex><span>    mps_device = torch.device(<span style=color:#ed9d13>&#34;mps&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#999;font-style:italic># Set fastai&#39;s `default_device()` to MPS</span>
</span></span><span style=display:flex><span>    <span style=color:#999;font-style:italic># https://github.com/fastai/fastai/blob/0d952d3c234629ec6d6a909186e79af3c5a9a1b8/fastai/torch_core.py#L271</span>
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>try</span>:
</span></span><span style=display:flex><span>        default_device(mps_device)
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>except</span>:
</span></span><span style=display:flex><span>        <span style=color:#24909d>print</span>(<span style=color:#ed9d13>&#34;default_device() is not defined. Did you import `fastai`?&#34;</span>)
</span></span></code></pre></div><h2 id=kaggle-competition-snippet>Kaggle competition snippet</h2><p>Use this snippet at the top of Kaggle notebooks and non-Kaggle hosted notebooks.</p><div class=highlight><pre tabindex=0 style=color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#6ab825;font-weight:700>import</span> <span style=color:#447fcf;text-decoration:underline>os</span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>from</span> <span style=color:#447fcf;text-decoration:underline>pathlib</span> <span style=color:#6ab825;font-weight:700>import</span> Path
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>competition = <span style=color:#ed9d13>&#34;titanic&#34;</span>  <span style=color:#999;font-style:italic># Change this to any Kaggle competition name</span>
</span></span><span style=display:flex><span>iskaggle = os.environ.get(<span style=color:#ed9d13>&#34;KAGGLE_KERNEL_RUN_TYPE&#34;</span>, <span style=color:#ed9d13>&#34;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>if</span> iskaggle:
</span></span><span style=display:flex><span>    path = Path(<span style=color:#ed9d13>f</span><span style=color:#ed9d13>&#34;../input/</span><span style=color:#ed9d13>{</span>competition<span style=color:#ed9d13>}</span><span style=color:#ed9d13>&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#6ab825;font-weight:700>else</span>:
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>import</span> <span style=color:#447fcf;text-decoration:underline>kaggle</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#999;font-style:italic># Use .kaggle_data folders that will be gitignored</span>
</span></span><span style=display:flex><span>    path = Path(<span style=color:#ed9d13>&#34;.kaggle_data&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#6ab825;font-weight:700>if</span> <span style=color:#6ab825;font-weight:700>not</span> path.exists():
</span></span><span style=display:flex><span>        <span style=color:#6ab825;font-weight:700>import</span> <span style=color:#447fcf;text-decoration:underline>zipfile</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        kaggle.api.competition_download_cli(competition=competition, path=<span style=color:#24909d>str</span>(path))
</span></span><span style=display:flex><span>        zipfile.ZipFile(<span style=color:#ed9d13>f</span><span style=color:#ed9d13>&#34;</span><span style=color:#ed9d13>{</span>path<span style=color:#ed9d13>}</span><span style=color:#ed9d13>/</span><span style=color:#ed9d13>{</span>competition<span style=color:#ed9d13>}</span><span style=color:#ed9d13>.zip&#34;</span>).extractall(path)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#24909d>print</span>(<span style=color:#ed9d13>f</span><span style=color:#ed9d13>&#34;Ready for competition: </span><span style=color:#ed9d13>{</span>competition<span style=color:#ed9d13>}</span><span style=color:#ed9d13>&#34;</span>)
</span></span></code></pre></div><h2 id=resources>Resources</h2><ul><li><a href=https://www.shanelynn.ie/pandas-iloc-loc-select-rows-and-columns-dataframe/>Pandas iloc and loc – quickly select rows and columns in DataFrames</a></li></ul><div class="border-t border-b border-gray text-muted my-8 py-4">Read more posts like this in the
<a href=/software-engineering-toolbox>Software Engineering Toolbox</a> collection.</div></div><div class=my-8><a href=https://briansigafoos.com/ class="text-base inline-block mb-1 py-2 px-6 cursor-pointer font-mono font-bold text-primary border border-solid border-primary bg-bright no-underline">Visit homepage</a></div><div class=my-8><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//briansigafoos.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div class="border-t border-gray py-4 my-16 w-full text-sm text-faint"><div class="container max-w-4xl text-center font-mono"><div class="sm:flex items-center justify-between"><span>Made with
<a href=https://gohugo.io rel=nofollow target=hugo class=underline>Hugo</a> &
        <a href=https://tailwindcss.com rel=nofollow target=tw class=underline>TailwindCSS</a>
·
<a href=https://github.com/BrianSigafoos/hugo_site rel=nofollow target=source class=underline>Source code</a></span>
<span class="block sm:inline mt-2 sm:mt-0">By <a href=/about class="text-primary font-black">Brian Sigafoos</a></span></div></div></div></body></html>